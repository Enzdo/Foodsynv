import{H as i,G as o}from"./D1Xstx_g.js";const u=i("auth",{state:()=>({user:null,token:null,isAuthenticated:!1,isLoading:!1}),getters:{currentUser:e=>e.user,isLoggedIn:e=>e.isAuthenticated&&!!e.token},actions:{init(){{const e=localStorage.getItem("auth_token"),t=localStorage.getItem("auth_user");e&&t&&(this.token=e,this.user=JSON.parse(t),this.isAuthenticated=!0)}},async register(e){const t=o();this.isLoading=!0;try{const a=await fetch(`${t.public.apiBase}/api/v1/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await a.json();if(!a.ok)throw new Error(s.message||"Erreur lors de l'inscription");return this.setAuth(s.user,s.token.value),{success:!0,message:s.message}}catch(a){return{success:!1,message:a.message}}finally{this.isLoading=!1}},async login(e,t){const a=o();this.isLoading=!0;try{const s=await fetch(`${a.public.apiBase}/api/v1/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await s.json();if(!s.ok)throw new Error(r.message||"Email ou mot de passe incorrect");return this.setAuth(r.user,r.token.value),{success:!0,message:r.message}}catch(s){return{success:!1,message:s.message}}finally{this.isLoading=!1}},async logout(){const e=o();try{this.token&&await fetch(`${e.public.apiBase}/api/v1/auth/logout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}})}catch(t){console.error("Logout error:",t)}finally{this.clearAuth()}},async fetchUser(){const e=o();if(this.token)try{const t=await fetch(`${e.public.apiBase}/api/v1/auth/me`,{headers:{Authorization:`Bearer ${this.token}`}});if(!t.ok){this.clearAuth();return}const a=await t.json();this.user=a.user}catch{this.clearAuth()}},setAuth(e,t){this.user=e,this.token=t,this.isAuthenticated=!0,localStorage.setItem("auth_token",t),localStorage.setItem("auth_user",JSON.stringify(e))},clearAuth(){this.user=null,this.token=null,this.isAuthenticated=!1,localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user")}}});export{u};
