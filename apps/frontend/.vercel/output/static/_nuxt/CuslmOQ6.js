import{H as m,G as n}from"./D1Xstx_g.js";import{u as o}from"./DivAE8d_.js";import{u as c}from"./Ba0zKJDI.js";const l=m("shopping",{state:()=>({items:[],isLoading:!1}),getters:{pendingItems:s=>s.items.filter(t=>!t.isPurchased),purchasedItems:s=>s.items.filter(t=>t.isPurchased),remainingCount:s=>s.items.filter(t=>!t.isPurchased).length,progressPercentage:s=>s.items.length===0?0:Math.round(s.items.filter(t=>t.isPurchased).length/s.items.length*100)},actions:{async fetchItems(){const s=n(),t=o(),i=c();if(!(!t.token||!i.currentFamilyId)){this.isLoading=!0;try{const e=await fetch(`${s.public.apiBase}/api/v1/shopping?familyId=${i.currentFamilyId}`,{headers:{Authorization:`Bearer ${t.token}`}});if(e.ok){const a=await e.json();this.items=a.items}}catch(e){console.error("Error fetching shopping items:",e)}finally{this.isLoading=!1}}},async addItem(s){const t=n(),i=o(),e=c();if(!i.token||!e.currentFamilyId)return{success:!1,message:"Non authentifié ou pas de famille"};this.isLoading=!0;try{const a=await fetch(`${t.public.apiBase}/api/v1/shopping`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.token}`},body:JSON.stringify({familyId:e.currentFamilyId,...s})}),r=await a.json();return a.ok?(this.items.unshift(r.item),{success:!0,message:r.message,item:r.item}):{success:!1,message:r.message}}catch(a){return{success:!1,message:a.message}}finally{this.isLoading=!1}},async toggleItem(s){const t=n(),i=o();if(!i.token)return{success:!1,message:"Non authentifié"};try{const e=await fetch(`${t.public.apiBase}/api/v1/shopping/${s}/toggle`,{method:"POST",headers:{Authorization:`Bearer ${i.token}`}}),a=await e.json();if(e.ok){const r=this.items.findIndex(u=>u.id===s);return r!==-1&&(this.items[r]=a.item),{success:!0,message:a.message}}else return{success:!1,message:a.message}}catch(e){return{success:!1,message:e.message}}},async deleteItem(s){const t=n(),i=o();if(!i.token)return{success:!1,message:"Non authentifié"};try{const e=await fetch(`${t.public.apiBase}/api/v1/shopping/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${i.token}`}}),a=await e.json();return e.ok?(this.items=this.items.filter(r=>r.id!==s),{success:!0,message:a.message}):{success:!1,message:a.message}}catch(e){return{success:!1,message:e.message}}},async clearPurchased(){const s=n(),t=o(),i=c();if(!t.token||!i.currentFamilyId)return{success:!1,message:"Non authentifié"};try{const e=await fetch(`${s.public.apiBase}/api/v1/shopping/clear-purchased?familyId=${i.currentFamilyId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.token}`}}),a=await e.json();return e.ok?(this.items=this.items.filter(r=>!r.isPurchased),{success:!0,message:a.message}):{success:!1,message:a.message}}catch(e){return{success:!1,message:e.message}}}}});export{l as u};
