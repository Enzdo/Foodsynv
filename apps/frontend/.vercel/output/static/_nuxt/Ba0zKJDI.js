import{H as o,G as r}from"./D1Xstx_g.js";import{u as n}from"./DivAE8d_.js";const m=o("family",{state:()=>({families:[],currentFamily:null,members:[],isLoading:!1}),getters:{hasFamily:s=>s.families.length>0,currentFamilyId:s=>s.currentFamily?.id||null},actions:{async fetchFamilies(){const s=r(),t=n();if(t.token){this.isLoading=!0;try{const i=await fetch(`${s.public.apiBase}/api/v1/families`,{headers:{Authorization:`Bearer ${t.token}`}});if(i.ok){const e=await i.json();this.families=e.families,this.families.length>0&&!this.currentFamily&&(this.currentFamily=this.families[0])}}catch(i){console.error("Error fetching families:",i)}finally{this.isLoading=!1}}},async createFamily(s){const t=r(),i=n();if(!i.token)return{success:!1,message:"Non authentifié"};this.isLoading=!0;try{const e=await fetch(`${t.public.apiBase}/api/v1/families`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.token}`},body:JSON.stringify({name:s})}),a=await e.json();return e.ok?(await this.fetchFamilies(),this.currentFamily=a.family,{success:!0,message:a.message,family:a.family}):{success:!1,message:a.message}}catch(e){return{success:!1,message:e.message}}finally{this.isLoading=!1}},async joinFamily(s){const t=r(),i=n();if(!i.token)return{success:!1,message:"Non authentifié"};this.isLoading=!0;try{const e=await fetch(`${t.public.apiBase}/api/v1/families/join`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.token}`},body:JSON.stringify({inviteCode:s})}),a=await e.json();return e.ok?(await this.fetchFamilies(),this.currentFamily=a.family,{success:!0,message:a.message,family:a.family}):{success:!1,message:a.message}}catch(e){return{success:!1,message:e.message}}finally{this.isLoading=!1}},async fetchFamilyDetails(s){const t=r(),i=n();if(i.token)try{const e=await fetch(`${t.public.apiBase}/api/v1/families/${s}`,{headers:{Authorization:`Bearer ${i.token}`}});if(e.ok){const a=await e.json();this.members=a.family.members}}catch(e){console.error("Error fetching family details:",e)}},async leaveFamily(s){const t=r(),i=n();if(!i.token)return{success:!1,message:"Non authentifié"};try{const e=await fetch(`${t.public.apiBase}/api/v1/families/${s}/leave`,{method:"DELETE",headers:{Authorization:`Bearer ${i.token}`}}),a=await e.json();return e.ok?(await this.fetchFamilies(),this.currentFamily?.id===s&&(this.currentFamily=this.families[0]||null),{success:!0,message:a.message}):{success:!1,message:a.message}}catch(e){return{success:!1,message:e.message}}},setCurrentFamily(s){this.currentFamily=s,localStorage.setItem("current_family_id",String(s.id))},loadCurrentFamily(){{const s=localStorage.getItem("current_family_id");if(s&&this.families.length>0){const t=this.families.find(i=>i.id===Number(s));t&&(this.currentFamily=t)}}}}});export{m as u};
