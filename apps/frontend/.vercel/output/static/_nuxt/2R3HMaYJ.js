import{H as f,G as n}from"./D1Xstx_g.js";import{u as o}from"./DivAE8d_.js";import{u as c}from"./Ba0zKJDI.js";const d=f("fridge",{state:()=>({items:[],expiringItems:[],isLoading:!1}),getters:{fridgeItems:e=>e.items.filter(i=>i.storageLocation==="fridge"),freezerItems:e=>e.items.filter(i=>i.storageLocation==="freezer"),pantryItems:e=>e.items.filter(i=>i.storageLocation==="pantry"),itemCount:e=>e.items.length,expiringCount:e=>e.expiringItems.length},actions:{async fetchItems(){const e=n(),i=o(),a=c();if(!(!i.token||!a.currentFamilyId)){this.isLoading=!0;try{const s=await fetch(`${e.public.apiBase}/api/v1/fridge?familyId=${a.currentFamilyId}`,{headers:{Authorization:`Bearer ${i.token}`}});if(s.ok){const t=await s.json();this.items=t.items}}catch(s){console.error("Error fetching fridge items:",s)}finally{this.isLoading=!1}}},async fetchExpiringItems(e=7){const i=n(),a=o(),s=c();if(!(!a.token||!s.currentFamilyId))try{const t=await fetch(`${i.public.apiBase}/api/v1/fridge/expiring?familyId=${s.currentFamilyId}&days=${e}`,{headers:{Authorization:`Bearer ${a.token}`}});if(t.ok){const r=await t.json();this.expiringItems=r.items}}catch(t){console.error("Error fetching expiring items:",t)}},async addItem(e){const i=n(),a=o(),s=c();if(!a.token||!s.currentFamilyId)return{success:!1,message:"Non authentifié ou pas de famille"};this.isLoading=!0;try{const t=await fetch(`${i.public.apiBase}/api/v1/fridge`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.token}`},body:JSON.stringify({familyId:s.currentFamilyId,...e})}),r=await t.json();return t.ok?(this.items.push(r.item),{success:!0,message:r.message,item:r.item}):{success:!1,message:r.message}}catch(t){return{success:!1,message:t.message}}finally{this.isLoading=!1}},async updateItem(e,i){const a=n(),s=o();if(!s.token)return{success:!1,message:"Non authentifié"};try{const t=await fetch(`${a.public.apiBase}/api/v1/fridge/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.token}`},body:JSON.stringify(i)}),r=await t.json();if(t.ok){const m=this.items.findIndex(u=>u.id===e);return m!==-1&&(this.items[m]=r.item),{success:!0,message:r.message,item:r.item}}else return{success:!1,message:r.message}}catch(t){return{success:!1,message:t.message}}},async deleteItem(e){const i=n(),a=o();if(!a.token)return{success:!1,message:"Non authentifié"};try{const s=await fetch(`${i.public.apiBase}/api/v1/fridge/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.token}`}}),t=await s.json();return s.ok?(this.items=this.items.filter(r=>r.id!==e),{success:!0,message:t.message}):{success:!1,message:t.message}}catch(s){return{success:!1,message:s.message}}},async consumeItem(e){const i=n(),a=o();if(!a.token)return{success:!1,message:"Non authentifié"};try{const s=await fetch(`${i.public.apiBase}/api/v1/fridge/${e}/consume`,{method:"POST",headers:{Authorization:`Bearer ${a.token}`}}),t=await s.json();return s.ok?(this.items=this.items.filter(r=>r.id!==e),{success:!0,message:t.message}):{success:!1,message:t.message}}catch(s){return{success:!1,message:s.message}}}}});export{d as u};
